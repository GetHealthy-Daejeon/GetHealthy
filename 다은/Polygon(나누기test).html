<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>건강하슈</title>
    <style>
      .area {
        position: absolute;
        background: #fff;
        border: 2px solid #888;
        border-radius: 5px;
        font-size: 30px;
        top: -5px;
        left: 15px;
        padding: 3%;
        font-weight: bold;
        width: auto;
        height: auto;
        color: rgb(7, 165, 213);
        /* hover시 등장하는 text box 설정 */
      }

      .info {
        font-size: 12px;
        padding: 5px;
      }
      .info .title {
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div id="map" style="width: 100%; height: 950px"></div>
    <p id="result"></p>
  </body>
  <script
    src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
    crossorigin="anonymous"
  ></script>
  <script
    type="text/javascript"
    src="//dapi.kakao.com/v2/maps/sdk.js?appkey=a73b8837893f3cb09f044c404d50bca2"
  ></script>
  <script>

   
    function setZoomable(zoomable) {  // 마우스 휠로 지도 확대,축소 가능여부를 설정하는 함수
    map.setZoomable(zoomable);    
    }

    var mapContainer = document.getElementById("map"), // 지도를 div
      mapOption = {
        center: new kakao.maps.LatLng(36.3504119, 127.3845475), // 중심좌표
        level: 8,
      };
    var map = new kakao.maps.Map(mapContainer, mapOption); // 지도 생성
    // 행정구 이름 표시
    (customOverlay = new kakao.maps.CustomOverlay({})), 
    (infowindow = new kakao.maps.InfoWindow({ removable: true }));
    var markerPosition = new kakao.maps.LatLng(36.3504119, 127.3845475); // 마커 위치

    // 마커 생성
    var marker = new kakao.maps.Marker({
      position: markerPosition,
      clickable: true, // 마커를 클릭했을 때 지도의 클릭 이벤트가 발생하지 않도록 설정
    });
    marker.setMap(map); // 마커 표시

    // 마커 제거
    // marker.setMap(null);

    // 마커 클릭하면 나올 인포윈도우
    var iwContent =
        '<div style="padding:10px; font-size: 20px; width: 100%; font-weight: 900" >여기는 대전광역시</div>',
      iwRemoveable = true; // 인포윈도우를 닫는 x버튼 표시

    // 인포윈도우 생성
    var infowindow = new kakao.maps.InfoWindow({
      content: iwContent,
      removable: iwRemoveable,
    });

    // 마커 위에 인포윈도우 표시
    kakao.maps.event.addListener(marker, "click", function () {
      infowindow.open(map, marker);
    });
  </script>
  <script>
    var polygons = []; // 폴리곤 지울때 사용하는 배열 담는 변수

    //지도 위 표시되고 있는 폴리곤 제거
    function deletePolygon(polygons) {
      console.log(polygons.length)
      for (var i = 0; i < polygons.length; i++) {
        polygons[i].setMap(null);
      }
      polygons = [];
    }

// 유성구
    // 유성구 폴리곤 데이터 갖고오기
    $.getJSON("구별json/yuseong.json", function (geojson) {
      var data = geojson.features;
      var coordinates = []; // 좌표 저장
      var name = ""; // 구 이름
      $.each(data, function (index, val) {
        coordinates = val.geometry.coordinates;
        name = val.properties.SGG_NM;
        displayYuseongArea(coordinates, name);
      });
    });
    // 유성구 폴리곤 생성
    function displayYuseongArea(coordinates, name) {
      var yuseongPolygonPath = [];
      var points = [];
      $.each(coordinates[0], function (index, coordinate) {
        // coordinates [0]번째에 배열 있음
        var point = new Object();
        point.x = coordinate[1]; // 경도
        point.y = coordinate[0]; // 위도
        points.push(point);
        yuseongPolygonPath.push(new kakao.maps.LatLng(coordinate[1], coordinate[0]));
        //new kakao.maps.LatLng가 없으면 인식을 못해서 polygonPath 배열에 추가
      });
      // 유성구 다각형 설정
      var yuseongPolygon = new kakao.maps.Polygon({
        map: map, // 다각형을 표시할 지도 객체
        path: yuseongPolygonPath, // 좌표 배열
        strokeWeight: 4, // 선 두께 // ======> 0624 두껍게 조절
        strokeColor: "#FFFFFF", // 선 색깔 
        strokeOpacity: 0.8, // 선 불투명도
        fillColor: "#6ADF35", // 채우기 색깔 // ======> 0624 색상 변경
        fillOpacity: 0.8, // 채우기 불투명도 // ======> 0624 투명도 진하게 조절
      });
      polygons.push(yuseongPolygon); // 폴리곤 제거하기 위한 배열      
      // 유성구 폴리곤을 클릭하면 유성구 행정동 폴리곤 데이터 가져오기
      kakao.maps.event.addListener(yuseongPolygon, 'click', function(mouseEvent) {
        var level = map.getLevel()-2;
        // map.setLevel(level, {anchor: centroid(points), animate: {
        map.setLevel(level, {anchor: new daum.maps.LatLng(mouseEvent.latLng.getLat(), mouseEvent.latLng.getLng()), animate: {
            duration: 350 // 확대 애니메이션 시간
        }});
        $.getJSON("행정동json/yuseong-gu.json", function (geojson) {
          var data = geojson.features;
          var coordinates = []; // 좌표 저장
          var dongName = ""; // 동 이름
          $.each(data, function (index, val) {
            coordinates = val.geometry.coordinates;
            name = val.properties.SGG_NM;
            displayYuseong_dong(coordinates, name);
            setZoomable(false) // 클릭시 마우스 휠 작동 off
          });
        });
        deletePolygon(polygons); //폴리곤 제거
        customOverlay.setMap(null); // 커스텀 오버레이(구 이름) 제거
      });

      // 마우스오버 이벤트
      kakao.maps.event.addListener(yuseongPolygon, "mouseover", function () {
        yuseongPolygon.setOptions(mouseoverOption);
      });
      // 마우스오버 이벤트 채우기
      var mouseoverOption = {
        fillColor: "#09f", // 색상
        fillOpacity: 0.8, // 불투명도
      };
     // 마우스아웃 이벤트
      daum.maps.event.addListener(yuseongPolygon, "mouseout", function () {
        yuseongPolygon.setOptions(mouseoutOption)
      });
      // 마우스아웃 채우기
      var mouseoutOption = {
        fillColor: "#6ADF35", // 채우기 색깔 초록색 : A2FF99
        fillOpacity: 0.8, // 채우기 불투명도
      };

      // 커스텀 오버레이 내용
      // var content = '<div class ="label"><span class="left"></span><span class="center">유성구</span><span class="right"></span></div>';
      var content = '<div class ="label" style ="font-size:30px">유성구</div>';
      // 커스텀 오버레이 위치
      var position = centroid(points);  
      // 커스텀 오버레이 생성
      var customOverlay = new kakao.maps.CustomOverlay({
          position: position,
          content: content   
      });
      // 커스텀 오버레이를 지도에 표시
      customOverlay.setMap(map);
    }

    // 유성구 행정동 폴리곤 만들기
    function displayYuseong_dong(coordinates, name) {
      var yuseong_dong_PolygonPath = [];
      $.each(coordinates[0], function (index, coordinate) {
        yuseong_dong_PolygonPath.push(new kakao.maps.LatLng(coordinate[1], coordinate[0]));
      });
      var yuseong_dong_Polygon = new kakao.maps.Polygon({
        map: map, // 다각형을 표시할 지도 객체
        path: yuseong_dong_PolygonPath, // 좌표 배열
        strokeWeight: 2, // 선 두께
        strokeColor: "#00ff0000", // 선 색깔 // 폴리곤 구분선 삭제 
        strokeOpacity: 0.8, // 선 불투명도
        fillColor: "#6ADF35", // 채우기 색깔
        fillOpacity: 0.5, // 채우기 불투명도
      });
      yuseong_dong_Polygon.setOptions({
          fillColor: "#00ff0000", // 행정동 폴리곤 배경색
          fillOpacity: 0.5
      })
    }

// 대덕구
    // 대덕구 
    $.getJSON("구별json/daedeok.json", function (geojson) {
      var data = geojson.features;
      var coordinates = []; 
      var name = "";
      $.each(data, function (index, val) {
        coordinates = val.geometry.coordinates;
        name = val.properties.SGG_NM;
        displayDaedeokArea(coordinates, name);
      });
    });
    // 대덕구 폴리곤 생성
    function displayDaedeokArea(coordinates, name) {
      var daedeokPolygonPath = [];
      var points = [];
      $.each(coordinates[0], function (index, coordinate) {
        var point = new Object();
        point.x = coordinate[1];
        point.y = coordinate[0];
        points.push(point);
        daedeokPolygonPath.push(new kakao.maps.LatLng(coordinate[1], coordinate[0]));
      });
      // 대덕구 다각형 설정
      var daedeokPolygon = new kakao.maps.Polygon({
        map: map, // 다각형을 표시할 지도 객체
        path: daedeokPolygonPath, // 좌표 배열
        strokeWeight: 4, // 선 두께
        strokeColor: "#FFFFFF", // 선 색깔
        strokeOpacity: 0.8, // 선 불투명도
        fillColor: "#FFD700", // 채우기 색깔
        fillOpacity: 0.8, // 채우기 불투명도
      });
      polygons.push(daedeokPolygon); // 폴리곤 제거하기 위한 배열
      // 대덕구 폴리곤을 클릭하면 대덕구 행정동 폴리곤 데이터 가져오기
      kakao.maps.event.addListener(daedeokPolygon, 'click', function(mouseEvent) {
        var level = map.getLevel()-2;
        map.setLevel(level, {anchor: centroid(points), animate: {
            duration: 350 // 확대 애니메이션 시간
        }});  
        $.getJSON("행정동json/daedeok-gu.json", function (geojson) {
          var data = geojson.features;
          var coordinates = [];
          var dongName = "";
          $.each(data, function (index, val) {
            coordinates = val.geometry.coordinates;
            name = val.properties.SGG_NM;
            displayYuseong_dong(coordinates, name);
            setZoomable(false) // 클릭시 마우스 휠 작동 off
          });
        });
        deletePolygon(polygons);
        customOverlay.setMap(null); // 커스텀 오버레이(구 이름) 제거
      });
      
         // 마우스오버 이벤트
         kakao.maps.event.addListener(daedeokPolygon, "mouseover", function () {
          daedeokPolygon.setOptions(mouseoverOption);
      });
      // 마우스오버 이벤트 채우기
      var mouseoverOption = {
        fillColor: "#09f", // 색상
        fillOpacity: 0.8, // 불투명도
      };
     // 마우스아웃 이벤트
      daum.maps.event.addListener(daedeokPolygon, "mouseout", function () {
        daedeokPolygon.setOptions(mouseoutOption)
      });
      // 마우스아웃 채우기
      var mouseoutOption = {
        fillColor: "#FFD700", // 채우기 색깔 초록색 : A2FF99
        fillOpacity: 0.8, // 채우기 불투명도
      };

      // 커스텀 오버레이 내용
      // var content = '<div class ="label"><span class="left"></span><span class="center">유성구</span><span class="right"></span></div>';
      var content = '<div class ="label" style ="font-size:30px">대덕구</div>';
      // 커스텀 오버레이 위치
      var position = centroid(points);  
      // 커스텀 오버레이 생성
      var customOverlay = new kakao.maps.CustomOverlay({
          position: position,
          content: content   
      });
      // 커스텀 오버레이를 지도에 표시
      customOverlay.setMap(map);
    }


// 동구 --- 멀티폴리곤(성남동) 구현 필요함
    // 동구 
    $.getJSON("구별json/dong.json", function (geojson) {
      var data = geojson.features;
      var coordinates = []; // 좌표 저장
      var name = ""; // 구 이름
      $.each(data, function (index, val) {
        coordinates = val.geometry.coordinates;
        name = val.properties.SGG_NM;
        displayDongArea(coordinates, name);
      });
    });
    // 동구 폴리곤 생성
    function displayDongArea(coordinates, name) {
      var dongPolygonPath = [];
      var points = [];
      $.each(coordinates[0], function (index, coordinate) {
        var point = new Object();
        point.x = coordinate[1];
        point.y = coordinate[0];
        points.push(point);
        dongPolygonPath.push(new kakao.maps.LatLng(coordinate[1], coordinate[0]));
      });
      // 동구 다각형 설정
      var dongPolygon = new kakao.maps.Polygon({
        map: map, // 다각형을 표시할 지도 객체
        path: dongPolygonPath, // 좌표 배열
        strokeWeight: 4, // 선 두께
        strokeColor: "#FFFFFF", // 선 색깔
        strokeOpacity: 0.8, // 선 불투명도
        fillColor: "#87CEFA", // 채우기 색깔
        fillOpacity: 0.8, // 채우기 불투명도
      });
      polygons.push(dongPolygon); // 폴리곤 제거하기 위한 배열
      // 동구 폴리곤을 클릭하면 대덕구 행정동 폴리곤 데이터 가져오기
      kakao.maps.event.addListener(dongPolygon, 'click', function(mouseEvent) {
        var level = map.getLevel()-2;
        map.setLevel(level, {anchor: centroid(points), animate: {
            duration: 350 // 확대 애니메이션 시간
        }});  
        $.getJSON("행정동json/dong-gu.json", function (geojson) {
          var data = geojson.features;
          var coordinates = [];
          var dongName = "";
          $.each(data, function (index, val) {
            coordinates = val.geometry.coordinates;
            name = val.properties.SGG_NM;
            displayYuseong_dong(coordinates, name);
            setZoomable(false) // 클릭시 마우스 휠 작동 off
          });
        });
        deletePolygon(polygons);
      });
      // 마우스오버 이벤트
      kakao.maps.event.addListener(dongPolygon, "mouseover", function () {
        dongPolygon.setOptions(mouseoverOption);
      });
      // 마우스오버 이벤트 채우기
      var mouseoverOption = {
        fillColor: "#09f", // 색상
        fillOpacity: 0.8, // 불투명도
      };
     // 마우스아웃 이벤트
      daum.maps.event.addListener(dongPolygon, "mouseout", function () {
        dongPolygon.setOptions(mouseoutOption)
      });
      // 마우스아웃 채우기
      var mouseoutOption = {
        fillColor: "#6ADF35", // 채우기 색깔 초록색 : A2FF99
        fillOpacity: 0.8, // 채우기 불투명도
      };

      // 커스텀 오버레이 내용
      // var content = '<div class ="label"><span class="left"></span><span class="center">유성구</span><span class="right"></span></div>';
      var content = '<div class ="label" style ="font-size:30px">동구</div>';
      // 커스텀 오버레이 위치
      var position = centroid(points);  
      // 커스텀 오버레이 생성
      var customOverlay = new kakao.maps.CustomOverlay({
          position: position,
          content: content   
      });
      // 커스텀 오버레이를 지도에 표시
      customOverlay.setMap(map);
    }


// 중구
    // 중구 
    $.getJSON("구별json/jung.json", function (geojson) {
      var data = geojson.features;
      var coordinates = []; // 좌표 저장
      var name = ""; // 구 이름
      $.each(data, function (index, val) {
        coordinates = val.geometry.coordinates;
        name = val.properties.SGG_NM;
        displayJungArea(coordinates, name);
      });
    });
    // 중구 폴리곤 생성
    function displayJungArea(coordinates, name) {
      var daedeokPolygonPath = [];
      var points = [];
      $.each(coordinates[0], function (index, coordinate) {
        var point = new Object();
        point.x = coordinate[1];
        point.y = coordinate[0];
        points.push(point);
        daedeokPolygonPath.push(new kakao.maps.LatLng(coordinate[1], coordinate[0]));
      });
      // 중구 다각형 설정
      var daedeokPolygon = new kakao.maps.Polygon({
        map: map, // 다각형을 표시할 지도 객체
        path: daedeokPolygonPath, // 좌표 배열
        strokeWeight: 4, // 선 두께
        strokeColor: "#FFFFFF", // 선 색깔
        strokeOpacity: 0.8, // 선 불투명도
        fillColor: "#FF4500", // 채우기 색깔
        fillOpacity: 0.8, // 채우기 불투명도
      });
      polygons.push(daedeokPolygon); // 폴리곤 제거하기 위한 배열
      // 중구 폴리곤을 클릭하면 대덕구 행정동 폴리곤 데이터 가져오기
      kakao.maps.event.addListener(daedeokPolygon, 'click', function(mouseEvent) {
        var level = map.getLevel()-2;
        map.setLevel(level, {anchor: centroid(points), animate: {
            duration: 350 // 확대 애니메이션 시간
        }});  
        $.getJSON("행정동json/jung-gu.json", function (geojson) {
          var data = geojson.features;
          var coordinates = [];
          var dongName = "";
          $.each(data, function (index, val) {
            coordinates = val.geometry.coordinates;
            name = val.properties.SGG_NM;
            displayDongArea(coordinates, name);
            setZoomable(false) // 클릭시 마우스 휠 작동 off
          });
        });
        deletePolygon(polygons);
      });
    }


// 서구
    // 서구 
    $.getJSON("구별json/seo.json", function (geojson) {
      var data = geojson.features;
      var coordinates = []; // 좌표 저장
      var name = ""; // 구 이름
      $.each(data, function (index, val) {
        coordinates = val.geometry.coordinates;
        name = val.properties.SGG_NM;
        displaySeoArea(coordinates, name);
      });
    });
    // 서구 폴리곤 생성
    function displaySeoArea(coordinates, name) {
      var daedeokPolygonPath = [];
      var points = [];
      $.each(coordinates[0], function (index, coordinate) {
        var point = new Object();
        point.x = coordinate[1];
        point.y = coordinate[0];
        points.push(point);
        daedeokPolygonPath.push(new kakao.maps.LatLng(coordinate[1], coordinate[0]));
      });
      // 서구 다각형 설정
      var daedeokPolygon = new kakao.maps.Polygon({
        map: map, // 다각형을 표시할 지도 객체
        path: daedeokPolygonPath, // 좌표 배열
        strokeWeight: 4, // 선 두께
        strokeColor: "#FFFFFF", // 선 색깔
        strokeOpacity: 0.8, // 선 불투명도
        fillColor: "#F08080", // 채우기 색깔
        fillOpacity: 0.8, // 채우기 불투명도
      });
      polygons.push(daedeokPolygon); // 폴리곤 제거하기 위한 배열
      // 서구 폴리곤을 클릭하면 대덕구 행정동 폴리곤 데이터 가져오기
      kakao.maps.event.addListener(daedeokPolygon, 'click', function(mouseEvent) {
        var level = map.getLevel()-2;
        map.setLevel(level, {anchor: centroid(points), animate: {
            duration: 350 // 확대 애니메이션 시간
        }});  
        $.getJSON("행정동json/seo-gu.json", function (geojson) {
          var data = geojson.features;
          var coordinates = [];
          var dongName = "";
          $.each(data, function (index, val) {
            coordinates = val.geometry.coordinates;
            name = val.properties.SGG_NM;
            displayYuseong_dong(coordinates, name);
            setZoomable(false) // 클릭시 마우스 휠 작동 off
          });
        });
        deletePolygon(polygons);
      });
    }



    //centroid 알고리즘 (폴리곤 중심좌표 구하기 위함)
    function centroid(points) {
      var i, j, len, p1, p2, f, area, x, y;

      area = x = y = 0;

      for (i = 0, len = points.length, j = len - 1; i < len; j = i++) {
        p1 = points[i];
        p2 = points[j];

        f = p1.y * p2.x - p2.y * p1.x;
        x += (p1.x + p2.x) * f;
        y += (p1.y + p2.y) * f;
        area += f * 3;
      }
      return new daum.maps.LatLng(x / area, y / area);
    }


  </script>
</html>
